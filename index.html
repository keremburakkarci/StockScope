<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StockScope - Modern Hisse Takip</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
</head>
<body>
    <!-- Modern Header -->
    <header class="modern-header">
        <div class="header-content">
            <div class="logo-section">
                <div class="logo-icon">📈</div>
                <h1 class="app-title">StockScope</h1>
            </div>
            <button id="global-legend-btn" class="info-btn" title="Renk ve sembol açıklamaları">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
                </svg>
            </button>
        </div>
    </header>
    
    <!-- Global Legend Modal -->
    <div id="global-legend-modal" class="legend-info-modal" style="display: none;">
        <div class="legend-content">
            <div class="legend-header">
                <h3 style="margin: 0; color: #fff; font-size: 1.2em;">📊 Renk ve Sembol Açıklamaları</h3>
                <button id="global-legend-close" class="legend-close" style="background: none; border: none; color: #fff; font-size: 1.8em; cursor: pointer; padding: 0; width: 35px; height: 35px; transition: all 0.2s;">×</button>
            </div>
            <div class="legend-body">
                <div class="legend-section">
                    <h4 style="color: #3498db; margin: 12px 0 10px 0; font-size: 1em;">📈 Trend Göstergeleri</h4>
                    <div class="legend-item"><span style="color: #00ff00; font-size: 1.6em;">🚀</span> <strong style="color: #00ff00;">Güçlü Yükseliş</strong> <span style="color: #888;">- En pozitif durum</span></div>
                    <div class="legend-item"><span style="color: #51cf66; font-size: 1.6em;">📈</span> <strong style="color: #51cf66;">Yükseliş</strong> <span style="color: #888;">- Pozitif trend</span></div>
                    <div class="legend-item"><span style="color: #f39c12; font-size: 1.6em;">➡️</span> <strong style="color: #f39c12;">Yatay</strong> <span style="color: #888;">- Nötr durum</span></div>
                    <div class="legend-item"><span style="color: #ff6b6b; font-size: 1.6em;">📉</span> <strong style="color: #ff6b6b;">Düşüş</strong> <span style="color: #888;">- Negatif trend</span></div>
                    <div class="legend-item"><span style="color: #ff4444; font-size: 1.6em;">💥</span> <strong style="color: #ff4444;">Güçlü Düşüş</strong> <span style="color: #888;">- En negatif durum</span></div>
                </div>
                <div class="legend-section">
                    <h4 style="color: #3498db; margin: 18px 0 10px 0; font-size: 1em;">💰 Fiyat Pozisyonu (Ucuzluk Göstergesi)</h4>
                    <div class="legend-item"><span style="color: #ff00ff; font-size: 1.6em;">🟢</span> <strong style="color: #ff00ff;">Dip Fiyat</strong> <span style="color: #888;">- EN UCUZ! Alım için mükemmel</span></div>
                    <div class="legend-item"><span style="color: #00ff00; font-size: 1.6em;">💚</span> <strong style="color: #00ff00;">İyi Fiyat</strong> <span style="color: #888;">- İyi alım seviyesi</span></div>
                    <div class="legend-item"><span style="color: #ffff00; font-size: 1.6em;">🟡</span> <strong style="color: #ffff00;">Orta Fiyat</strong> <span style="color: #888;">- Normal seviye</span></div>
                    <div class="legend-item"><span style="color: #ff8800; font-size: 1.6em;">🟠</span> <strong style="color: #ff8800;">Yüksek Fiyat</strong> <span style="color: #888;">- Satış düşünülebilir</span></div>
                    <div class="legend-item"><span style="color: #ff0000; font-size: 1.6em;">🔴</span> <strong style="color: #ff0000;">Tepe Fiyat</strong> <span style="color: #888;">- ÇOK PAHALI! Satış zamanı</span></div>
                </div>
                <div style="margin-top: 18px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); font-size: 0.85em; color: #888; text-align: center; line-height: 1.5;">
                    <strong style="color: #3498db;">ℹ️ Bilgi:</strong> Tüm analizler 250 günlük veri üzerinden yapılmaktadır.<br>
                    Trend ve fiyat pozisyonu göstergeleri her kartın alt kısmında yer alır.
                </div>
            </div>
        </div>
    </div>
    
    <div class="container">
                <div class="modern-controls">
                    <div class="control-row">
                        <div class="input-section">
                            <input type="text" id="stock-input" class="modern-input" placeholder="Hisse Kodu (örn: THYAO, AAPL)">
                            <button id="add-stock-btn" class="modern-btn primary-btn">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                                    <line x1="12" y1="5" x2="12" y2="19"></line>
                                    <line x1="5" y1="12" x2="19" y2="12"></line>
                                </svg>
                                <span>Ekle</span>
                            </button>
                        </div>
                        <div class="action-section">
                            <button id="refresh-btn" class="modern-btn refresh-btn">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"/>
                                </svg>
                                <span>Yenile</span>
                            </button>
                            <div class="sort-buttons">
                                <button id="sort-gainers-btn" class="modern-btn sort-btn gainers-btn" title="En Çok Yükselenler">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                                        <path d="M12 19V5M5 12l7-7 7 7"/>
                                    </svg>
                                    <span>Yükselenler</span>
                                </button>
                                <button id="sort-losers-btn" class="modern-btn sort-btn losers-btn" title="En Çok Düşenler">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                                        <path d="M12 5v14M19 12l-7 7-7-7"/>
                                    </svg>
                                    <span>Düşenler</span>
                                </button>
                                <button id="sort-reset-btn" class="modern-btn sort-btn reset-btn" title="Normal Sıralama" style="display: none;">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M3 6h18M3 12h18M3 18h18"/>
                                    </svg>
                                    <span>Normal</span>
                                </button>
                            </div>
                            <button id="reset-order-btn" class="modern-btn secondary-btn">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M3 12h18M3 6h18M3 18h18"/>
                                </svg>
                                <span>Sıralamayı Sıfırla</span>
                            </button>
                            <div class="view-toggle">
                                <button class="view-btn active" id="card-view-btn" title="Kart Görünümü">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                        <rect x="1" y="1" width="6" height="6" rx="1"/>
                                        <rect x="9" y="1" width="6" height="6" rx="1"/>
                                        <rect x="1" y="9" width="6" height="6" rx="1"/>
                                        <rect x="9" y="9" width="6" height="6" rx="1"/>
                                    </svg>
                                </button>
                                <button class="view-btn" id="list-view-btn" title="Liste Görünümü">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                        <rect x="1" y="2" width="14" height="2" rx="1"/>
                                        <rect x="1" y="7" width="14" height="2" rx="1"/>
                                        <rect x="1" y="12" width="14" height="2" rx="1"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
        <div id="stock-container" class="stock-container">
            <!-- Hisse senetleri buraya eklenecek -->
        </div>
    </div>

    <!-- Debug / Observation Panel -->
    <div id="debug-panel" class="debug-panel" style="display:none;">
        <div class="debug-header">
            <span>Pre / Post Market Gözlem Paneli</span>
            <button id="close-debug" class="close-debug">✖</button>
        </div>
        <div class="debug-body">
            <table id="debug-table">
                <thead>
                    <tr>
                        <th>Sembol</th>
                        <th>State</th>
                        <th>Pre</th>
                        <th>Kaynak</th>
                        <th>Post</th>
                        <th>Kaynak</th>
                        <th>Regular</th>
                        <th>Prev Close</th>
                        <th>Δ%</th>
                        <th>Güncelleme</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
        <div class="debug-footer">
            <small>Kaynak Rozetleri: Y = Yahoo API, ~ = Türetilmiş (barlardan). Otomatik 15 sn'de yenilenir.</small>
        </div>
    </div>

    <!-- Stock Detail Modal -->
    <div id="chart-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-stock-symbol"></h2>
                <span class="close-btn">&times;</span>
            </div>
            
            <!-- Two Column Layout: Analysis (Left) + Chart (Right) -->
            <div class="modal-body">
                <!-- Left Column: Analysis Panel -->
                <div class="analysis-column">
                    <div id="technical-analysis-panel" class="ta-panel">
                        <!-- Filled by JavaScript -->
                    </div>
                </div>
                
                <!-- Right Column: Chart -->
                <div class="chart-column">
                    <div class="chart-container">
                        <div id="tradingview-widget" class="tradingview-widget"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="script_new.js"></script>
    <style>
        .debug-panel {position:fixed; right:12px; bottom:12px; width:780px; max-height:60vh; background:#1e1e24; border:1px solid #444; border-radius:8px; box-shadow:0 4px 18px rgba(0,0,0,.4); display:flex; flex-direction:column; font-family:system-ui,Arial; z-index:9999;}
        .debug-panel table {width:100%; border-collapse:collapse; font-size:12px;}
        .debug-panel th, .debug-panel td {padding:4px 6px; border-bottom:1px solid #333; text-align:left; white-space:nowrap;}
        .debug-panel thead {background:#2a2a33; position:sticky; top:0;}
        .debug-header {display:flex; justify-content:space-between; align-items:center; padding:6px 10px; background:#2d2d35; border-bottom:1px solid #444; font-weight:600; font-size:13px;}
        .debug-body {overflow:auto;}
        .close-debug {background:transparent; color:#bbb; border:none; cursor:pointer; font-size:14px;}
        .close-debug:hover {color:#fff;}
        .debug-footer {padding:4px 8px; font-size:11px; color:#888; background:#23232a; border-top:1px solid #333;}
        .val-pos {color:#2ecc71;}
        .val-neg {color:#e74c3c;}
    .src-badge {display:inline-block; margin-left:2px; padding:0 4px; font-size:10px; border-radius:3px; background:#3a3a45; color:#ccc;}
    .market-status.inline-badge {position:absolute; top:6px; left:6px; padding:2px 6px; font-size:10px; background:#444; border-radius:4px; text-transform:uppercase; letter-spacing:.5px;}
    .market-status.inline-badge.premarket {background:#8e44ad;}
    .market-status.inline-badge.postmarket {background:#d35400;}
        .src-badge[data-kind="derived"] {background:#55515a; color:#ddd;}
        #toggle-debug-btn {background:#3b3f52; color:#eee; border:none; padding:6px 10px; border-radius:4px; cursor:pointer;}
        #toggle-debug-btn:hover {background:#4a5066;}
    </style>
</body>
</html>
